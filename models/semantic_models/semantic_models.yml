semantic_models:
  - name: fact_trips
    description: "NYC Taxi Trips fact table"
    model: ref('trips_dashboard')

    entities:
      - name: trip
        type: primary
        expr: trip_id

    dimensions:
      - name: pickup_datetime
        type: time
        type_params:
          time_granularity: day

      - name: dropoff_datetime
        type: time
        type_params:
          time_granularity: day

      - name: pickup_ntaname
        type: categorical

      - name: dropoff_ntaname
        type: categorical

      - name: payment_type
        type: categorical

      - name: passenger_count
        type: categorical

      - name: trip_duration_minutes
        expr: "dateDiff('minute', pickup_datetime, dropoff_datetime)"
        type: categorical

      - name: trip_day_of_week
        expr: "toDayOfWeek(pickup_datetime)"
        type: categorical

    measures:
      - name: trips
        agg: count

      - name: total_amount
        expr: total_amount
        agg: sum

      - name: avg_trip_amount
        expr: total_amount
        agg: average

      - name: total_tips
        expr: tip_amount
        agg: sum

      - name: avg_tip_pct
        expr: "tip_amount / nullIf(fare_amount, 0)"
        agg: average
